<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PVRT — Training & Map Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Leaflet (no SRI to avoid integrity mismatch) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    crossorigin=""
  ></script>

  <link href="./styles.css" rel="stylesheet" />
</head>
<body>
  <header class="header">
    <div class="brand">
      <h1>PVRT</h1>
      <span class="sub">RGB + Thermal Pipeline</span>
    </div>
    <div class="health">
      <button id="btnHealth" class="btn secondary">Check API</button>
      <span id="healthStatus" class="status">Unknown</span>
    </div>
  </header>

  <nav class="tabs">
    <button class="tab active" data-tab="train">Train</button>
    <button class="tab" data-tab="test">Test</button>
    <button class="tab" data-tab="layers">Layers / Map</button>
  </nav>

  <main>
    <!-- TRAIN TAB -->
    <section id="tab-train" class="tabPanel active">
      <div class="card">
        <h2>Training</h2>
        <p class="muted">Uses dataset folders: <code>data/train</code> and <code>data/valid</code>. Validation runs during training.</p>

        <div class="formGrid">
          <label class="switchRow">
            <input type="checkbox" id="chkUseThermalTrain" />
            <span>Use thermal band</span>
          </label>

          <label>
            <span>Iterations</span>
            <input id="inpMaxIter" type="number" min="100" step="100" value="500" />
          </label>

          <label>
            <span>Learning rate</span>
            <input id="inpBaseLR" type="number" step="0.0001" value="0.002" />
          </label>

          <label>
            <span>Images per batch</span>
            <input id="inpBatch" type="number" min="1" step="1" value="4" />
          </label>
        </div>

        <div class="actions">
          <button id="btnTrain" class="btn primary">
            <span class="spinner hidden" id="spinTrain"></span>
            Start Training
          </button>
        </div>

        <div class="alert warn" id="trainWarn" hidden></div>
        <div class="alert err" id="trainErr" hidden></div>
        <div class="alert ok" id="trainOk" hidden></div>
      </div>
    </section>

    <!-- TEST TAB -->
    <section id="tab-test" class="tabPanel">
      <div class="card">
        <h2>Test / Inference</h2>
        <p class="muted">Upload one or more images (<code>.jpg</code>, <code>.png</code>, <code>.tif</code>).</p>

        <div class="formGrid">
          <label class="switchRow">
            <input type="checkbox" id="chkUseThermalTest" />
            <span>Use thermal band</span>
          </label>

          <label class="fileDrop">
            <input id="filesTest" type="file" multiple accept=".jpg,.jpeg,.png,.tif,.tiff,.JPG,.JPEG,.PNG,.TIF,.TIFF" />
            <span>Choose images… (or drag & drop)</span>
          </label>
        </div>

        <div class="actions">
          <button id="btnTest" class="btn primary">
            <span class="spinner hidden" id="spinTest"></span>
            Run Test
          </button>
        </div>

        <div class="alert warn" id="testWarn" hidden></div>
        <div class="alert err" id="testErr" hidden></div>
        <div class="alert ok" id="testOk" hidden></div>
      </div>
    </section>

    <!-- LAYERS / MAP TAB -->
    <section id="tab-layers" class="tabPanel">
      <div class="mapWrap">
        <div id="map"></div>
        <div class="mapPanel">
          <h3>Layers</h3>
          <div class="layerList" id="layerList"></div>
          <div class="divider"></div>
          <h4>Add overlay</h4>
          <label class="fileDrop small">
            <input id="fileGeoJson" type="file" accept=".geojson,.json" />
            <span>Add GeoJSON…</span>
          </label>
          <div class="legend">
            <p><span class="sym sym-point"></span> Image location</p>
            <p><span class="sym sym-poly"></span> Anomaly point (from detections)</p>
          </div>
        </div>
      </div>
    </section>

    <!-- LOGS -->
    <section class="panel">
      <div class="logsHeader">
        <h2>Live Logs</h2>
        <div class="logControls">
          <span id="logConn" class="status">Disconnected</span>
          <button id="btnClearLogs" class="btn secondary">Clear</button>
        </div>
      </div>
      <pre id="logStream" class="logStream" aria-live="polite"></pre>
    </section>
  </main>

  <script src="./app.js"></script>
</body>
</html>